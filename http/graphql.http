# Prexis GraphQL 接口测试
# 测试 GraphQL 查询和变更操作

@baseURL = http://localhost:3000

# 测试数据
@testPostId = test-post-001
@testTitle = 测试文章标题
@testContent = 这是一个测试文章的内容，用于验证 GraphQL 接口的功能。

###
# ==================== Schema 查询 ====================

# 1. 内省查询 - 获取所有类型
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "{ __schema { types { name kind } } }"
}

###
# 2. 内省查询 - 获取 Query 字段
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "{ __schema { queryType { fields { name description } } } }"
}

###
# 3. 内省查询 - 获取 Mutation 字段
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "{ __schema { mutationType { fields { name description } } } }"
}

###
# ==================== 文章查询（真实数据库） ====================

# 4. 获取所有文章
# @name listPosts
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "query { listPosts { id title content } }"
}

###
# 5. 根据 ID 获取文章
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "query GetPost($postId: String!) { getPostById(postId: $postId) { id title content } }",
    "variables": {
        "postId": "{{testPostId}}"
    }
}

###
# ==================== 文章变更（真实数据库） ====================

# 6. 创建文章
# @name createPost
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "mutation CreatePost($post: CreatePostBlog!) { createPost(post: $post) { id title content } }",
    "variables": {
        "post": {
            "id": "{{testPostId}}",
            "title": "{{testTitle}}",
            "content": "{{testContent}}"
        }
    }
}

###
# 7. 更新文章
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "mutation UpdatePost($post: UpdatePostBlog!) { updatePost(post: $post) { id title content } }",
    "variables": {
        "post": {
            "id": "{{testPostId}}",
            "title": "更新后的标题",
            "content": "更新后的内容"
        }
    }
}

###
# 8. 删除文章
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "mutation DeletePost($postId: String!) { deletePost(postId: $postId) { id title } }",
    "variables": {
        "postId": "{{testPostId}}"
    }
}

###
# ==================== Mock 接口测试 ====================

# 9. Mock - 获取所有文章
# @name listPostsMock
POST {{baseURL}}/graphql/mock
Content-Type: application/json

{
    "query": "query { listPosts { id title content } }"
}

###
# 10. Mock - 根据 ID 获取文章
POST {{baseURL}}/graphql/mock
Content-Type: application/json

{
    "query": "query GetPost($postId: String!) { getPostById(postId: $postId) { id title content } }",
    "variables": {
        "postId": "1"
    }
}

###
# 11. Mock - 创建文章
POST {{baseURL}}/graphql/mock
Content-Type: application/json

{
    "query": "mutation CreatePost($post: CreatePostBlog!) { createPost(post: $post) { id title content } }",
    "variables": {
        "post": {
            "title": "Mock 测试文章",
            "content": "这是 Mock 接口创建的文章"
        }
    }
}

###
# 12. Mock - 更新文章
POST {{baseURL}}/graphql/mock
Content-Type: application/json

{
    "query": "mutation UpdatePost($post: UpdatePostBlog!) { updatePost(post: $post) { id title content } }",
    "variables": {
        "post": {
            "id": "1",
            "title": "Mock 更新的标题"
        }
    }
}

###
# 13. Mock - 删除文章
POST {{baseURL}}/graphql/mock
Content-Type: application/json

{
    "query": "mutation DeletePost($postId: String!) { deletePost(postId: $postId) { id } }",
    "variables": {
        "postId": "1"
    }
}

###
# ==================== 错误场景 ====================

# 14. 查询不存在的字段
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "{ nonExistentField }"
}

###
# 15. 语法错误
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "{ listPosts { id title"
}

###
# 16. 缺少必填变量
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "query GetPost($postId: String!) { getPostById(postId: $postId) { id } }"
}

###
# 17. 无效的变量类型
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": "query GetPost($postId: String!) { getPostById(postId: $postId) { id } }",
    "variables": {
        "postId": 12345
    }
}

###
# 18. 空查询
POST {{baseURL}}/graphql
Content-Type: application/json

{
    "query": ""
}
